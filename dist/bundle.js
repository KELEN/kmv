!function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function i(t){var e=t.el,r=document.querySelector(e);return this.data=t.data,this.renderQueue=new a.RenderQueue(r),this.$data=o.observer(t.data,this),this.watch=t.watch||{},this.pendingValue=!1,this.pendingArray=!1,this.circle={},this.changeQueue=[],this.methods=t.methods,n.renderInit(this),this}var n=r(11),o=r(10),a=r(7);window.Kmv=i,Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},function(t,e){"use strict";e.Attr={K_MODEL:"k-model"},e.RegexpStr={brace:/\{\{((?:.|\n)+?)\}\}/,forStatement:/([a-z_]+[\w]*)\s+in\s+([a-z_][\w.]+)/,bracket:/\[['|"]?(\w+)['|"]?\]/,isString:/'([^']*)'|"([^\"]*)"/,isParams:/^[^"|^'\d]+.*/,arithmeticOp:/\*|\+|-\/|\(|\)/g,inputElement:/INPUT|TEXTAREA/,arrtibuteKey:/k-for|k-model|k-if|k:.*|k-on:(.*)/,kAttribute:/k:(.*)/,kOnAttribute:/k-on:(.*)/,methodAndParam:/([a-zA-Z\d_]+)\((.*)\)/,isTernaryOp:/!.*|!!.*|.+?.+:.+/,ternaryOpSplit:/\?|:|\(|\)|!!/},e.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,COMMENT:8,DOCUMENT:9},e.ArrayMethod=["push","pop","splice","shift","unshift","sort","reverse"];var r;!function(t){t[t.TEXT=0]="TEXT",t[t.INPUT=1]="INPUT",t[t.TEXTAREA=2]="TEXTAREA",t[t.FOR=3]="FOR",t[t.IF=4]="IF",t[t.ATTRIBUTE=5]="ATTRIBUTE"}(r=e.RenderType||(e.RenderType={}));var i;!function(t){t[t.PUSH=0]="PUSH",t[t.POP=1]="POP",t[t.SORT=2]="SORT",t[t.CHANGE=3]="CHANGE",t[t.SHIFT=4]="SHIFT"}(i=e.ArrayOp||(e.ArrayOp={}))},function(t,e,r){"use strict";var i=r(1);e.getDotVal=function(t,e){var r,n;if(e){e=e.replace(i.RegexpStr.bracket,".$1"),r=t;for(var o=e.split(".")||[e];n=o.shift();){if(!r){r=void 0;break}r=r[n]}}return r},e.depCopy=function(t){var r={};for(var i in t)"object"==typeof t[i]?Array.isArray(t[i])?r[i]=t[i].slice(0):r[i]=e.depCopy(t[i]):r[i]=t[i];return r},e.setObserveDotVal=function(t,e,r){e=e.replace(i.RegexpStr.bracket,".$1");for(var n=t,o=e.split("."),a=o.length,s=0;s<a-1;s++)n=n[o[s]];n[o[a-1]]=r}},function(t,e){"use strict";e.insertAfter=function(t,e){t&&t.parentNode&&t.parentNode.insertBefore(e,t.nextSibling)},e.createTextNode=function(t){return document.createTextNode(t)},e.createElement=function(t){return document.createElement(t)},e.inserBefore=function(t,e){t&&t.parentNode&&t.parentNode.insertBefore(e,t)},e.deleteNode=function(t,e){t&&e&&t.removeChild(e)},e.changeNodeValue=function(t,e){t&&t.firstChild&&(t.firstChild.nodeValue=e)},e.changeTextContent=function(t,e){t&&(t.textContent=e)},e.removeAttribute=function(t,e){t&&t.removeAttribute(e)},e.findIteratorNode=function(t,r){for(var i=t.childNodes,n=[],o=0;o<i.length;o++){var a=i[o];a.forString&&a.forKey&&a.forKey==r&&n.push(a),a.childNodes.length&&n.concat(e.findIteratorNode(a,r))}return n},e.hideNode=function(t){t.style.display="none"},e.showNode=function(t){t.style.display="block"},e.removeNode=function(t){t&&t.parentNode.removeChild(t)}},function(t,e,r){"use strict";var i=r(5),n=r(1),o=r(12),a=r(1),s=r(6),c=r(2),u=function(){function t(t){this.vdomAttr={},t.attributes&&(this.attributes=[].slice.call(t.attributes).slice(0))}return t.prototype.renderAttr=function(t){if(this.nodeType===n.NodeType.ELEMENT){var e=t.$data,r=this.$dom,o=this.attributes;console.log(o);for(var u=0;u<o.length;u++){var d=o[u],p=d.nodeName,h=d.nodeValue;if(a.RegexpStr.kAttribute.test(p)){var l=d.nodeName.replace(a.RegexpStr.kAttribute,"$1");if("class"===l){for(var f=h.split(","),m="",v=0;v<f.length;v++){var y=f[v].split(":")[0];c.getDotVal(e,y.trim())&&(m+=f[v].split(":")[1].trim()+" ")}r.setAttribute(l,m.trim()),r.removeAttribute(p)}else{var g=c.getDotVal(e,h);r.setAttribute(l,g),r.removeAttribute(p)}}else if(a.RegexpStr.kOnAttribute.test(p)){var b=p.replace(a.RegexpStr.kOnAttribute,"$1"),T=i.compileTpl(h,e),N=T.match(a.RegexpStr.methodAndParam),A=N[1],O=N[2];s.bindEvent(r,b,A,O,t.methods,t.data),r.removeAttribute(p)}else r.setAttribute(p,h)}}},t.prototype.reRenderAttr=function(t){if(this.nodeType===n.NodeType.ELEMENT)for(var e=t.data,r=this.$dom,u=0;u<this.attributes.length;u++){var d=this.attributes[u],p=d.nodeName,h=d.nodeValue;if(o.isKvmAttribute(p))if(a.RegexpStr.kAttribute.test(p)){var l=d.nodeName.replace(a.RegexpStr.kAttribute,"$1");if("class"===l){for(var f=h.split(","),m="",v=0;v<f.length;v++){var y=f[v].split(":")[0];c.getDotVal(e,y.trim())&&(m+=f[v].split(":")[1].trim()+" ")}r.setAttribute(l,m.trim()),r.removeAttribute(p)}else{var g=c.getDotVal(e,h);r.setAttribute(l,g),r.removeAttribute(p)}}else if(a.RegexpStr.kOnAttribute.test(p)){var b=p.replace(a.RegexpStr.kOnAttribute,"$1"),T=i.compileTpl(h,e),N=T.match(a.RegexpStr.methodAndParam),A=N[1],O=N[2];s.bindEvent(r,b,A,O,t.methods,t.data),r.removeAttribute(p)}else r.setAttribute(p,i.compileTpl(h,e));else r.setAttribute(p,h)}},t}();e.VDOM=u},function(module,exports,__webpack_require__){"use strict";var constant_1=__webpack_require__(1),object_1=__webpack_require__(2),function_1=__webpack_require__(9);exports.transArithmeticOp=function(tpl,obj){for(var opReg=constant_1.RegexpStr.arithmeticOp,arr=tpl.split(opReg),opRegArr=tpl.match(opReg),isParamReg=constant_1.RegexpStr.isParams,tmp,newStr="",i=0;i<arr.length;i++){if(tmp=arr[i].trim(),isParamReg.test(tmp)){var val=object_1.getDotVal(obj,tmp);isNaN(val)?newStr+='"'+val+'"':(val||(val=0),newStr+=val)}else newStr+=tmp;i<arr.length-1&&(newStr+=opRegArr[i])}var res=eval(newStr);return res},exports.transTernaryOperator=function(tpl,obj){for(var arr=tpl.split(/\?|:|\(|\)|\+|-|\*|\/|!/),match=tpl.match(/\?|:|\(|\)|\+|-|\*|\/|!/g),newStr="",i=0;i<arr.length;i++){var item=arr[i].trim();newStr+=item&&constant_1.RegexpStr.isParams.test(item)?"_data."+item:item,match[i]&&(newStr+=match[i])}return function(str,_data){return eval(str)}(newStr,obj)},exports.compileTpl=function(t,e){for(var r,i=constant_1.RegexpStr.brace;r=i.exec(t);){var n=r?r[1].trim():"";if(!n)return"";var o=function_1.evalJs(n,e);t=t.replace(i,o)}return t}},function(t,e){"use strict";e.bindEvent=function(t,e,r,i,n,o){void 0===i&&(i=""),t.addEventListener?t.addEventListener(e,function(){var t=i.split(",");n[r].apply(o,t)}):t.attachEvent("on"+e,function(){var t=i.split(",");n[r].apply(o,t)})}},function(t,e,r){"use strict";var i=r(1),n=r(13),o=r(18),a=r(17),s=r(16),c=function(){function t(t){this.queue=[],this.queue=this.queueInit(t)}return t.prototype.getQueue=function(){return this.queue},t.prototype.queueInit=function(t){for(var e=t.childNodes,r=0;r<e.length;r++){var c=e[r];switch(c.nodeType){case i.NodeType.TEXT:this.queue.push(new o.NormalDOM(c));break;case i.NodeType.ELEMENT:c.getAttribute("k-for")?this.queue.push(new n.ForDOM(c)):c.getAttribute("k-model")&&i.RegexpStr.inputElement.test(c.tagName)?this.queue.push(new a.InputDOM(c)):c.getAttribute("k-if")?this.queue.push(new s.IfDOM(c)):this.queue.push(new o.NormalDOM(c))}}return this.queue},t}();e.RenderQueue=c},function(t,e,r){"use strict";var i=r(1);e.diff=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]);for(var r=[],n=t.length,o=e.length,a=Math.min(n,o),s=0;s<a;s++)t[s]!==e[s]&&r.push({op:i.ArrayOp.CHANGE,index:s,text:e[s]});if(n>o)for(var c=t.slice(o),s=0;s<c.length;s++)r.push({op:i.ArrayOp.POP,index:s+o,text:c[s]});else{var u=e.slice(n);r.push({batch:!0,op:i.ArrayOp.PUSH,array:u})}return r}},function(t,e){"use strict";e.evalJs=function(t,e){return new Function("with(this){ return "+t+" }").call(e)},e.evalFunc=function(t){return new Function("with(this){ console.log(this); return "+t+" }")}},function(t,e,r){"use strict";function i(t,e,r){o.ArrayMethod.forEach(function(i){Object.defineProperty(t,i,{configurable:!1,enumerable:!1,writable:!1,value:function(){Array.prototype[i].apply(a.getDotVal(e.$data,r),arguments),e.changeQueue.push({kmv:e,bigKey:r}),e.pendingArray=!0}})})}var n=r(2),o=r(1),a=r(2);e.observer=function(t,r,o){void 0===o&&(o="");var s=n.depCopy(t),c=function(s){var c=o?o+"."+s:s;"object"==typeof t[s]?Array.isArray(t[s])?i(t[s],r,c):e.observer(t[s],r,c):Object.defineProperty(t,s,{set:function(t){n.setObserveDotVal(r.$data,c,t),r.pendingValue=!0,r.changeQueue.push({kmv:r,bigKey:c}),r.watch[c]&&r.watch[c].call(r.data,t)},get:function(){return a.getDotVal(r.$data,c)}})};for(var u in t)c(u);return s}},function(t,e,r){"use strict";var i=r(1),n=r(2),o=r(8);e.renderInit=function(t){for(var r=t.renderQueue,i=r.getQueue(),n=0;n<i.length;n++){var o=i[n];o.renderInit(t)}e.nextTick(t)},e.nextTick=function(t){setTimeout(function(){if(t.pendingValue){console.log("reRender"),t.pendingValue=!1;var r=t.changeQueue.pop();e.reRender(r.kmv,r.bigKey),t.changeQueue.length=0}if(t.pendingArray){console.log("reRenderFor"),t.pendingArray=!1;var r=t.changeQueue.pop();e.reRenderFor(r.kmv,r.bigKey),t.changeQueue.length=0}e.nextTick(t)},0)},e.reRender=function(t,e){for(var r=t.renderQueue.getQueue(),i=0;i<r.length;i++){var n=r[i];n.reRender(t)}},e.reRenderFor=function(t,e){for(var r=t.renderQueue.getQueue(),a=t.$data,s=0;s<r.length;s++){var c=r[s];if(c.renderType==i.RenderType.FOR){var u=c.forObjectKey,d=n.getDotVal(a,u);if(Array.isArray(d)){var p=o.diff(c.iteratorData,d);c.notifyDataChange(p,t)}else c.notifyDataChange(null,t)}}}},function(t,e,r){"use strict";var i=r(1),n=function(t){return i.RegexpStr.brace.test(t)},o=function(t){return i.RegexpStr.forStatement.test(t)},a={isBraceReg:n,isForStatement:o};e.isKvmAttribute=function(t){return i.RegexpStr.arrtibuteKey.test(t)},Object.defineProperty(e,"__esModule",{value:!0}),e.default=a},function(t,e,r){"use strict";var i=r(14),n=r(1),o=r(2),a=r(3),s=function(){function t(t){this.childrenVdom=[],this.renderType=n.RenderType.FOR,this.previousSibling=t.previousSibling,this.nextSibling=t.nextSibling,this.templateNode=t,this.connect(t.previousElementSibling,t.nextElementSibling);var e=t.getAttribute("k-for"),r=n.RegexpStr.forStatement.exec(e);this.tagName=t.tagName,this.forString=e,this.forObjectKey=r[2].trim(),this.forKey=r[1].trim(),a.removeNode(t)}return t.prototype.renderInit=function(t){var e=o.getDotVal(t.$data,this.forObjectKey),r=document.createDocumentFragment();if(Array.isArray(e)){this.iteratorData=e.slice(0);for(var n=0;n<this.iteratorData.length;n++){var s=new i.ForItemDOM(this.templateNode);this.childrenVdom.push(s);var c=s.transDOM(this.iteratorData[n],this.forKey,t);r.appendChild(c)}a.insertAfter(this.previousSibling,r)}else if("object"==typeof e){this.iteratorData=e;for(var n in e){var s=new i.ForItemDOM(this.templateNode);this.childrenVdom.push(s);var c=s.transDOM(e[n],this.forKey,t);r.appendChild(c)}a.insertAfter(this.previousSibling,r)}this.connect(this.previousSibling,this.nextSibling)},t.prototype.connect=function(t,e){t&&(t.$nextSibling=this),this.$nextSibling=e},t.prototype.reRender=function(t){if(Array.isArray(this.iteratorData))for(var e=0,r=this.iteratorData.length;e<r;e++)this.childrenVdom[e].reRender(this.iteratorData[e],this.forKey,t);else{var i=0;for(var n in this.iteratorData)this.childrenVdom[i].reRender(this.iteratorData[n],this.forKey,t),i++}},t.prototype.notifyDataChange=function(t,e){var r=e.$data,i=this.forObjectKey,a=o.getDotVal(r,i)||[];if(Array.isArray(this.iteratorData)){this.iteratorData=a.slice(0);for(var s=0;s<t.length;s++){var c=t[s].op;if(t[s].batch)switch(c){case n.ArrayOp.PUSH:this.batchAdd(t[s].array,e)}else switch(c){case n.ArrayOp.PUSH:this.addNewItem(t[s].text,e);break;case n.ArrayOp.POP:this.popItem();break;case n.ArrayOp.CHANGE:this.changeItem(t[s].index,e);break;case n.ArrayOp.SHIFT:this.shiftItem()}}}},t.prototype.batchAdd=function(t,e){void 0===t&&(t=[]);for(var r=document.createDocumentFragment(),n=0,o=t.length;n<o;n++){var s=new i.ForItemDOM(this.templateNode);this.childrenVdom.push(s);var c=s.transDOM(t[n],this.forKey,e);r.appendChild(c)}a.inserBefore(this.nextSibling,r)},t.prototype.addNewItem=function(t,e){var r=new i.ForItemDOM(this.templateNode),n=r.transDOM(t,this.forKey,e);this.childrenVdom.push(r),a.inserBefore(this.nextSibling,n)},t.prototype.popItem=function(){var t=this.childrenVdom.pop();t.$dom&&a.removeNode(t.$dom)},t.prototype.changeItem=function(t,e){this.childrenVdom[t].reRender(this.iteratorData[t],this.forKey,e)},t.prototype.shiftItem=function(){var t=this.childrenVdom.shift();this.childrenVdom.shift(),a.removeNode(t.$dom)},t}();e.ForDOM=s},function(t,e,r){"use strict";var i=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},n=r(3),o=r(2),a=r(15),s=r(4),c=function(t){function e(e){var r=t.call(this,e)||this;r.childrenVdom=[];for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];r.childrenVdom.push(new a.ForNormalDOM(n))}return e.removeAttribute("k-for"),r.tagName=e.tagName,r.templateNode=e,r.attributes=e.attributes,r.nodeType=e.nodeType,r}return i(e,t),e.prototype.transDOM=function(t,e,r){var i=o.depCopy(o.getDotVal(r.$data,e));i[e]=t;for(var a=n.createElement(this.tagName),s=0;s<this.childrenVdom.length;s++)r.$$data=i,a.appendChild(this.childrenVdom[s].transDOM(r));return this.$dom=a,this.renderAttr(r),a},e.prototype.reRender=function(t,e,r){var i=o.depCopy(r.$data);i[e]=t,r.$$data=i,this.childrenVdom.forEach(function(t){t.reRender(r)}),this.renderAttr(r)},e}(s.VDOM);e.ForItemDOM=c},function(t,e,r){"use strict";var i=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},n=r(5),o=r(3),a=r(1),s=r(4),c=function(t){function e(r){var i=t.call(this,r)||this;switch(i.childrenVdom=[],i.tagName=r.tagName,i.attributes=r.attributes,i.nodeType=r.nodeType,r.nodeType){case a.NodeType.TEXT:i.template=r.textContent;break;case a.NodeType.ELEMENT:i.template=r.firstChild.nodeValue}if(r.childNodes)for(var n=0;n<r.childNodes.length;n++){var o=r.childNodes[n];i.childrenVdom.push(new e(o))}return i}return i(e,t),e.prototype.transDOM=function(t){var e=t.$$data,r=document.createElement(this.tagName);switch(this.nodeType){case a.NodeType.TEXT:r=o.createTextNode(this.tagName),r.textContent=n.compileTpl(this.template,e),this.$dom=r;break;case a.NodeType.ELEMENT:r=document.createElement(this.tagName),this.$dom=r,this.childrenVdom&&this.childrenVdom.forEach(function(e){r.appendChild(e.transDOM(t))}),this.renderAttr(t)}return this.renderAttr(t),r},e.prototype.reRender=function(t){var e=t.$$data,r=n.compileTpl(this.template,e);switch(this.nodeType){case a.NodeType.TEXT:o.changeTextContent(this.$dom,r);break;case a.NodeType.ELEMENT:this.childrenVdom.forEach(function(e){e.reRender(t)})}},e}(s.VDOM);e.ForNormalDOM=c},function(t,e,r){"use strict";var i=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},n=r(4),o=r(2),a=function(t){function e(e){var r=t.call(this,e)||this;return r.childrenVdom=[],r.tagName=e.tagName,r.attributes=e.attributes,r.nodeType=e.nodeType,r.kif=e.getAttribute("k-if"),r.$dom=e,e.removeAttribute("k-if"),r}return i(e,t),e.prototype.renderInit=function(t){var e=t.$data,r=o.getDotVal(e,this.kif);r?this.$dom.style.display="block":this.$dom.style.display="none"},e.prototype.reRender=function(t){var e=t.$data,r=o.getDotVal(e,this.kif);r?this.$dom.style.display="block":this.$dom.style.display="none"},e}(n.VDOM);e.IfDOM=a},function(t,e,r){"use strict";var i=r(2),n=function(){function t(t){this.childrenVdom=[],this.tagName=t.tagName,this.attributes=t.attributes,this.nodeType=t.nodeType,this.kmodel=t.getAttribute("k-model"),this.$dom=t,t.removeAttribute("k-model")}return t.prototype.renderInit=function(t){var e=this,r=t.$data;this.$dom.value=i.getDotVal(r,this.kmodel),this.$dom.oninput=function(r){i.setObserveDotVal(t.data,e.kmodel,e.$dom.value)}},t.prototype.reRender=function(t){var e=t.$data,r=i.getDotVal(e,this.kmodel);this.$dom.value=r},t}();e.InputDOM=n},function(t,e,r){"use strict";var i=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},n=r(5),o=r(3),a=r(1),s=r(4),c=function(t){function e(r){var i=t.call(this,r)||this;switch(i.childrenVdom=[],i.tagName=r.tagName,i.attributes=r.attributes&&[].slice.call(r.attributes).slice(0),i.nodeType=r.nodeType,i.$dom=r,r.nodeType){case a.NodeType.TEXT:i.template=r.textContent;break;case a.NodeType.ELEMENT:i.template=r.firstChild.nodeValue}if(r.childNodes)for(var n=0;n<r.childNodes.length;n++){var o=r.childNodes[n];i.childrenVdom.push(new e(o))}return i}return i(e,t),e.prototype.renderInit=function(t){var e=t.$data;switch(this.nodeType){case a.NodeType.TEXT:o.changeTextContent(this.$dom,n.compileTpl(this.template,e));break;case a.NodeType.ELEMENT:this.childrenVdom.forEach(function(e){e.renderInit(t)}),this.renderAttr(t)}},e.prototype.reRender=function(t){var e=t.$data,r=n.compileTpl(this.template,e);switch(this.nodeType){case a.NodeType.TEXT:o.changeTextContent(this.$dom,r);break;case a.NodeType.ELEMENT:this.childrenVdom.forEach(function(e){e.reRender(t)}),this.reRenderAttr(t)}},e}(s.VDOM);e.NormalDOM=c}]);
//# sourceMappingURL=bundle.js.map